<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>KrishiMitra â€” Smart Farming</title>

<style>
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(#f6b26b, #ffe5b4);
    font-family: system-ui, sans-serif;
  }

  .hero {
    position: absolute;
    top: 40px;
    left: 40px;
    max-width: 460px;
    z-index: 10;
  }

  .hero h1 {
    margin: 0;
    font-size: 40px;
    font-weight: 900;
  }

  .hero p {
    margin-top: 14px;
    font-size: 17px;
    line-height: 1.55;
    opacity: 0.85;
  }

  .label {
    position: absolute;
    background: rgba(255,255,255,0.95);
    padding: 8px 14px;
    border-radius: 16px;
    font-size: 13px;
    font-weight: 600;
    pointer-events: none;
    transform: translate(-50%, -50%);
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
  }

  /* MINI MAP */
  .minimap {
    position: absolute;
    bottom: 20px;
    right: 20px;
    width: 160px;
    height: 160px;
    background: rgba(255,255,255,0.9);
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    padding: 10px;
  }

  .map {
    position: relative;
    width: 100%;
    height: 100%;
    background: #7a8450;
    border-radius: 12px;
  }

  .dot {
    position: absolute;
    width: 10px;
    height: 10px;
    background: #e63946;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    cursor: pointer;
  }

  .cam {
    background: #000;
  }
</style>

<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.164.1/build/three.module.js",
    "three/examples/jsm/controls/OrbitControls.js":
      "https://unpkg.com/three@0.164.1/examples/jsm/controls/OrbitControls.js"
  }
}
</script>
</head>

<body>

<div class="hero">
  <h1>KrishiMitra</h1>
  <p>
    A smart farming platform combining AI insights, precision irrigation,
    weather intelligence, and community knowledge.
  </p>
</div>

<div class="label" id="l1">AI Crop Monitoring</div>
<div class="label" id="l2">Smart Irrigation</div>
<div class="label" id="l3">Weather Forecasting</div>
<div class="label" id="l4">Farmer Community</div>

<!-- MINI MAP -->
<div class="minimap">
  <div class="map" id="map"></div>
</div>

<script type="module">
import * as THREE from "three";
import { OrbitControls } from "three/examples/jsm/controls/OrbitControls.js";

/* SCENE */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xf6b26b);
scene.fog = new THREE.Fog(0xf6b26b, 40, 200);

/* CAMERA */
const camera = new THREE.PerspectiveCamera(48, innerWidth / innerHeight, 0.1, 500);
camera.position.set(90, 35, 0);

/* RENDERER */
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(innerWidth, innerHeight);
renderer.outputColorSpace = THREE.SRGBColorSpace;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.25;
document.body.appendChild(renderer.domElement);

/* CONTROLS */
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.enablePan = false;
controls.target.set(0, 12, 0);

/* LIGHTS */
scene.add(new THREE.AmbientLight(0xffffff, 0.4));
const sun = new THREE.DirectionalLight(0xffd6a5, 3);
sun.position.set(80, 120, 60);
scene.add(sun);

/* GROUND */
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(600, 600),
  new THREE.MeshStandardMaterial({ color: 0x7a8450 })
);
ground.rotation.x = -Math.PI / 2;
scene.add(ground);

/* FEATURES */
const features = [
  { name: "AI", pos: new THREE.Vector3(0, 0, 0), label: l1 },
  { name: "Irrigation", pos: new THREE.Vector3(0, 0, 40), label: l2 },
  { name: "Weather", pos: new THREE.Vector3(-40, 0, 20), label: l3 },
  { name: "Community", pos: new THREE.Vector3(40, 0, 20), label: l4 }
];

/* FEATURE MARKERS */
features.forEach(f => {
  const m = new THREE.Mesh(
    new THREE.BoxGeometry(10, 8, 10),
    new THREE.MeshStandardMaterial({ color: 0xb5523b })
  );
  m.position.copy(f.pos);
  m.position.y = 4;
  scene.add(m);
  f.mesh = m;
});

/* FARMER */
const farmer = new THREE.Mesh(
  new THREE.CapsuleGeometry(1, 3, 4, 8),
  new THREE.MeshStandardMaterial({ color: 0x6d597a })
);
farmer.position.set(-60, 1.6, -20);
scene.add(farmer);

/* FARMER PATH */
let pathT = 0;
function moveFarmer() {
  pathT += 0.002;
  farmer.position.x = Math.sin(pathT) * 60;
  farmer.position.z = Math.cos(pathT * 0.5) * 30;
  farmer.rotation.y = Math.atan2(
    Math.cos(pathT * 0.5),
    Math.sin(pathT)
  );
}

/* SMOOTH FOCUS */
let focusTarget = null;
let focusProgress = 0;

function focusOn(pos) {
  focusTarget = pos.clone();
  focusProgress = 0;
}

features.forEach(f => {
  f.mesh.userData.focus = () => focusOn(f.pos);
});

/* MINI MAP */
const map = document.getElementById("map");

features.forEach(f => {
  const d = document.createElement("div");
  d.className = "dot";
  d.style.left = (f.pos.x + 300) / 600 * 100 + "%";
  d.style.top  = (f.pos.z + 300) / 600 * 100 + "%";
  d.onclick = () => focusOn(f.pos);
  map.appendChild(d);
});

/* CAMERA DOT */
const camDot = document.createElement("div");
camDot.className = "dot cam";
map.appendChild(camDot);

/* ANIMATE */
function animate() {
  requestAnimationFrame(animate);

  moveFarmer();

  if (focusTarget) {
    focusProgress += 0.02;
    camera.position.lerp(
      new THREE.Vector3(
        focusTarget.x + 30,
        18,
        focusTarget.z + 30
      ),
      focusProgress
    );
    controls.target.lerp(focusTarget.clone().setY(8), focusProgress);
    if (focusProgress >= 1) focusTarget = null;
  }

  features.forEach(f => {
    const p = f.mesh.position.clone();
    p.y += 10;
    p.project(camera);
    f.label.style.left = ((p.x * 0.5 + 0.5) * innerWidth) + "px";
    f.label.style.top  = ((-p.y * 0.5 + 0.5) * innerHeight) + "px";
  });

  camDot.style.left = (camera.position.x + 300) / 600 * 100 + "%";
  camDot.style.top  = (camera.position.z + 300) / 600 * 100 + "%";

  controls.update();
  renderer.render(scene, camera);
}
animate();

/* RESIZE */
addEventListener("resize", () => {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>

</body>
</html>
